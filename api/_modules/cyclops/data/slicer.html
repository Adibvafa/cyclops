





<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>cyclops.data.slicer &mdash; cyclops  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/cyclops.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<script type="text/javascript">
  window.onload = function() {
    document.body.innerHTML = document.body.innerHTML.replace(/ module/g, '');
    document.body.innerHTML = document.body.innerHTML.replace(/ package/g, '');
  }
</script>

</head>

<body class="wy-body-for-nav">
  <!--
    Lie about what theme we really are when some RTD-injected JS fetches the
    full versions panel from the RTD API.  RTD's JS replaces the stub versions
    panel in the Sphinx-generated HTML with the full versions panel it fetches
    from the RTD API.  If the API thinks we're not sphinx_rtd_theme, it will
    serve us the wrong HTML and the panel will float as a "badge" when it
    shouldn't.  As a customized version of sphinx_rtd_theme, we really do want
    the same HTML it gets.  See also the diagnoses in
    <https://github.com/nextstrain/docs.nextstrain.org/issues/76>.

    This bit of JS finds the data RTD injects into the page and modifies it
    before the code that RTD injects runs and looks at the data.  RTD's
    <script>s (in <head>) run before this JS, but they wait until the DOM is
    ready to actually do any work.  This gives us a chance to modify the data
    during DOM load before the RTD code actually uses it.

      -trs, 27 Jan 2022
  -->
  <script>
    (() => {
      try {
        console.log("Lying about the theme to RTD's JS so the versions panel works properly. üôà");

        /* Update global variable, which is used in the request to get the RTD
         * "footer" that includes the versions panel.
         */
        if (window.READTHEDOCS_DATA)
          window.READTHEDOCS_DATA.theme = "sphinx_rtd_theme";

        /* Update stored JSON in case anything else deserializes it later.
         * Comments in the RTD-injected HTML source claim the global variable
         * above is deprecated.
         */
        var script = document.querySelector("#READTHEDOCS_DATA");
        if (script)
          script.innerHTML = JSON.stringify({ ...JSON.parse(script.innerHTML), theme: "sphinx_rtd_theme" });
      }
      catch (err) {
        console.log("Lying about the theme to RTD's JS failed‚Ä¶ oh well. ü§∑", err);
      }
    })();
  </script>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #efeeed" >




  <a href="https://vectorinstitute.github.io/cyclops/">
    <img src="../../../_static/cyclops_logo-dark.png" class="logo" alt="Logo"/>
  </a>



  <div class="subproject">
    <a href="../../../index.html" class="project-name" alt="Documentation Home">
      cyclops
    </a>

    
    
    

  </div>




<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html">üê£ Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html#developing">üßëüèø‚Äçüíª Developing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html#documentation">üìö Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html#notebooks">üìì Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html#citation">üéì Citation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing to cyclops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #efeeed" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">cyclops</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  

  
  
    <li><a href="https://vectorinstitute.github.io/cyclops/">Home</a></li>
    <li><a href="../../../index.html">cyclops</a></li>
  

  
  
    <li><a href="../../index.html">Module code</a></li>
  

  

      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for cyclops.data.slicer</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Functions and classes for creating subsets of Hugging Face datasets.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">dateutil.parser</span> <span class="kn">import</span> <span class="n">parse</span>


<div class="viewcode-block" id="SliceSpec"><a class="viewcode-back" href="../../../reference/api/_autosummary/cyclops.data.slicer.SliceSpec.html#cyclops.data.slicer.SliceSpec">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">SliceSpec</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Specifications for creating a slices of a dataset.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spec_list : List[Union[Dict[str, Any], List[Dict[str, Any]]]], default=[{}]</span>
<span class="sd">        A list of slice specifications. Each specification is a dictionary mapping</span>
<span class="sd">        a column name to a slice specification for that column. A slice specification</span>
<span class="sd">        is a dictionary containing one or more of the following keys:</span>

<span class="sd">        - `value`: The exact value of a column to select. This can be a single value</span>
<span class="sd">          a list of values. If a list of values is provided, the slice selects rows</span>
<span class="sd">          where the column value is in the list. Time strings are supported (e.g.</span>
<span class="sd">          `&quot;2021-01-01 00:00:00&quot;`).</span>
<span class="sd">        - `min_value`: The minimum value of a column to select. Specifying the</span>
<span class="sd">          `min_inclusive` key indicates whether to include the minimum value in the</span>
<span class="sd">          range. This works for numerical and datetime columns. Time strings are</span>
<span class="sd">          supported. The default value is set to -inf, if `max_value` is specified and</span>
<span class="sd">          `min_value` is not.</span>
<span class="sd">        - `min_inclusive`: Boolean value to indicated whether to include the `min_value`</span>
<span class="sd">          in the range. If True, the slice selects rows where the value is greater than</span>
<span class="sd">          or equal to the `min_value`. Defaults to True.</span>
<span class="sd">        - `max_value`: The maximum value of a column to select. This works for numerical</span>
<span class="sd">          and datetime columns. Specifying the `max_inclusive` key indicates whether to</span>
<span class="sd">          include the maximum value in the range.  Time strings are supported.</span>
<span class="sd">          The default value is set to `inf`, if `min_value` is specified and `max_value`</span>
<span class="sd">          is not.</span>
<span class="sd">        - `max_inclusive`: Boolean value to indicated whether to include the `max_value`</span>
<span class="sd">          in the range. If True, the slice selects rows where the value is less than or</span>
<span class="sd">          equal to the `max_value`. Defaults to True.</span>
<span class="sd">        - `year`: A single (numerical or string) value or list of values for selecting</span>
<span class="sd">          rows in a datetime column where the year matches the value(s). Defaults to</span>
<span class="sd">          None.</span>
<span class="sd">        - `month`: A single (numerical) value or list of values between 1 and 12 for</span>
<span class="sd">          selecting rows in a datetime column where the month matches the value(s).</span>
<span class="sd">          Defaults to None.</span>
<span class="sd">        - `day`: A single (numerical) value or list of values between 1 and 31 for</span>
<span class="sd">          selecting rows in a datetime column where the day matches the value(s).</span>
<span class="sd">          Defaults to None.</span>
<span class="sd">        - `hour`: A single (numerical) value or list of values between 0 and 23 for</span>
<span class="sd">          selecting rows in a datetime column where the hour matches the value(s).</span>
<span class="sd">          Defaults to None.</span>
<span class="sd">        - `negate`: A boolean flag indicating whether to negate the slice. If True, the</span>
<span class="sd">          slice selects rows where the feature value does not match the specification.</span>
<span class="sd">          Defaults to False.</span>
<span class="sd">        - `keep_nulls`: A boolean flag indicating whether to keep rows where the value</span>
<span class="sd">          is null. If used in conjunction with `negate`, the slice selects rows where</span>
<span class="sd">          the value is not null. Can be used on its own. Defaults to False.</span>
<span class="sd">    validate : bool, default=True</span>
<span class="sd">        Whether to validate the column names in the slice specifications.</span>
<span class="sd">    column_names : List[str], optional, default=None</span>
<span class="sd">        List of column names in the dataset. If provided and `validate` is True, it is</span>
<span class="sd">        used to validate the column names in the slice specifications.</span>


<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    spec_list : List[Union[Dict[str, Any], List[Dict[str, Any]]]]</span>
<span class="sd">        List of slice specifications.</span>
<span class="sd">    validate : bool</span>
<span class="sd">        Whether to validate the column names in the slice specifications.</span>
<span class="sd">    column_names : List[str]</span>
<span class="sd">        List of column names in the dataset.</span>
<span class="sd">    _registry : Dict[str, Callable]</span>
<span class="sd">        Dictionary mapping slice names to functions that create the slice.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from cyclops.data.slicer import SliceSpec</span>
<span class="sd">    &gt;&gt;&gt; slice_spec = SliceSpec(</span>
<span class="sd">    ...     spec_list=[</span>
<span class="sd">    ...         {&quot;feature_1&quot;: {&quot;keep_nulls&quot;: False}},</span>
<span class="sd">    ...         {</span>
<span class="sd">    ...             &quot;feature_2&quot;: {&quot;keep_nulls&quot;: False},</span>
<span class="sd">    ...             &quot;feature_3&quot;: {&quot;keep_nulls&quot;: False},</span>
<span class="sd">    ...         },</span>
<span class="sd">    ...         {&quot;feature_1&quot;: {&quot;value&quot;: &quot;value_1&quot;}},</span>
<span class="sd">    ...         {&quot;feature_1&quot;: {&quot;value&quot;: [&quot;value_1&quot;, &quot;value_2&quot;]}},</span>
<span class="sd">    ...         {&quot;feature_1&quot;: {&quot;value&quot;: &quot;value_1&quot;, &quot;negate&quot;: True, &quot;keep_nulls&quot;: True}},</span>
<span class="sd">    ...         {&quot;feature_1&quot;: {&quot;min_value&quot;: &quot;2020-01-01&quot;, &quot;max_value&quot;: &quot;2020-12-31&quot;}},</span>
<span class="sd">    ...         {&quot;feature_1&quot;: {</span>
<span class="sd">    ...             &quot;min_value&quot;: 5,</span>
<span class="sd">    ...             &quot;max_value&quot;: 60,</span>
<span class="sd">    ...             &quot;min_inclusive&quot;: False,</span>
<span class="sd">    ...             &quot;max_inclusive&quot;: False}</span>
<span class="sd">    ...         },</span>
<span class="sd">    ...         {&quot;feature_1&quot;: {&quot;year&quot;: [2020, 2021, 2022]}},</span>
<span class="sd">    ...         {&quot;feature_1&quot;: {&quot;month&quot;: [6, 7, 8]}},</span>
<span class="sd">    ...         {&quot;feature_1&quot;: {&quot;month&quot;: 6, &quot;day&quot;: 1}},</span>
<span class="sd">    ...         {&quot;feature_1&quot;: {&quot;contains&quot;: &quot;value_1&quot;}},</span>
<span class="sd">    ...         {&quot;feature_1&quot;: {&quot;contains&quot;: [&quot;value_1&quot;, &quot;value_2&quot;]}},</span>
<span class="sd">    ...         {</span>
<span class="sd">    ...             &quot;feature_1&quot;: {&quot;value&quot;: &quot;value_1&quot;},</span>
<span class="sd">    ...             &quot;feature_2&quot;: {</span>
<span class="sd">    ...                 &quot;min_value&quot;: &quot;2020-01-01&quot;, keep_nulls: False,</span>
<span class="sd">    ...             },</span>
<span class="sd">    ...             &quot;feature_3&quot;: {&quot;year&quot;: [&quot;2000&quot;, &quot;2010&quot;, &quot;2020&quot;]},</span>
<span class="sd">    ...         },</span>
<span class="sd">    ...     ],</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; for slice_name, slice_func in slice_spec.slices():</span>
<span class="sd">    ...     print(slice_name)</span>
<span class="sd">    ...     # do something with slice_func here (e.g. dataset.filter(slice_func))</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spec_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[{}],</span> <span class="n">init</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">repr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">compare</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">column_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">_registry</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]]]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compare</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create and register slice functions out of the slice specifications.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">slice_spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_and_register_slice_specs</span><span class="p">(</span><span class="n">slice_spec</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_registry</span><span class="p">[</span><span class="s2">&quot;overall&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">overall</span>  <span class="c1"># always add overall slice function</span>

<div class="viewcode-block" id="SliceSpec.add_slice_spec"><a class="viewcode-back" href="../../../reference/api/_autosummary/cyclops.data.slicer.SliceSpec.html#cyclops.data.slicer.SliceSpec.add_slice_spec">[docs]</a>    <span class="k">def</span> <span class="nf">add_slice_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slice_spec</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add slice specification to the list of slice specifications.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        slice_spec : Dict[str, Dict[str, Any]]</span>
<span class="sd">            A dictionary mapping column names to dictionaries containing one or more of</span>
<span class="sd">            the following keys: `value`, `min_value`, `max_value`, `year`, `month`,</span>
<span class="sd">            `day`, `hour`, `negate`, `keep_nulls`. See :class:`SliceSpec` for more</span>
<span class="sd">            details on the slice specification format.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_and_register_slice_specs</span><span class="p">(</span><span class="n">slice_spec</span><span class="o">=</span><span class="n">slice_spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spec_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slice_spec</span><span class="p">)</span></div>

<div class="viewcode-block" id="SliceSpec.get_slices"><a class="viewcode-back" href="../../../reference/api/_autosummary/cyclops.data.slicer.SliceSpec.html#cyclops.data.slicer.SliceSpec.get_slices">[docs]</a>    <span class="k">def</span> <span class="nf">get_slices</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the slice function registry.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_registry</span></div>

<div class="viewcode-block" id="SliceSpec.slices"><a class="viewcode-back" href="../../../reference/api/_autosummary/cyclops.data.slicer.SliceSpec.html#cyclops.data.slicer.SliceSpec.slices">[docs]</a>    <span class="k">def</span> <span class="nf">slices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a generator of slice names and slice functions.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">registration_key</span><span class="p">,</span> <span class="n">slice_function</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_registry</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">registration_key</span><span class="p">,</span> <span class="n">slice_function</span></div>

    <span class="k">def</span> <span class="nf">_parse_and_register_slice_specs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">slice_spec</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct and register a slice functions from slice specifications.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slice_spec</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Expected `slice_spec` to be a dictionary. Got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">slice_spec</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">slice_spec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># empty dictionary. Interpret as `overall` slice</span>
            <span class="n">registration_key</span> <span class="o">=</span> <span class="s2">&quot;overall&quot;</span>
            <span class="n">slice_function</span> <span class="o">=</span> <span class="n">overall</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">slice_spec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># slice on a single feature</span>
            <span class="n">registration_key</span><span class="p">,</span> <span class="n">slice_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_single_spec_dict</span><span class="p">(</span><span class="n">slice_spec</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># compound slicing (bitwise AND of component slices)</span>
            <span class="n">registration_key</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">slice_functions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">slice_spec</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">sub_registration_key</span><span class="p">,</span> <span class="n">slice_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_single_spec_dict</span><span class="p">(</span>
                    <span class="p">{</span><span class="n">column_name</span><span class="p">:</span> <span class="n">spec</span><span class="p">}</span>
                <span class="p">)</span>
                <span class="n">slice_functions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slice_function</span><span class="p">)</span>
                <span class="n">registration_key</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sub_registration_key</span><span class="si">}</span><span class="s2">&amp;&quot;</span>
            <span class="n">registration_key</span> <span class="o">=</span> <span class="n">registration_key</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># remove trailing ampersand</span>

            <span class="n">slice_function</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">compound_filter</span><span class="p">,</span> <span class="n">slice_functions</span><span class="o">=</span><span class="n">slice_functions</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_registry</span><span class="p">[</span><span class="n">registration_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">slice_function</span>

    <span class="k">def</span> <span class="nf">_parse_single_spec_dict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">slice_spec</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the registration key and slice function for a single slice spec.&quot;&quot;&quot;</span>
        <span class="n">column_name</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">slice_spec</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>

        <span class="c1"># validate column name and spec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_column_names</span><span class="p">(</span><span class="n">column_names</span><span class="o">=</span><span class="n">column_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Expected feature value to be a dictionary. Got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;value&quot;</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">:</span>  <span class="c1"># filter on exact value</span>
            <span class="n">substring</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
            <span class="n">negated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;negate&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

            <span class="n">registration_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">substring</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">substring</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="c1"># show at most 10 values in registration key. If more than 10,</span>
                <span class="c1"># show first 5, ..., last 5</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">substring</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                    <span class="n">value_list_repr</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">substring</span><span class="p">[:</span><span class="mi">5</span><span class="p">]))</span>
                        <span class="o">+</span> <span class="s2">&quot;, ..., &quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">substring</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]))</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value_list_repr</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">substring</span><span class="p">))</span>

                <span class="n">registration_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">value_list_repr</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">slice_function</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
                <span class="n">filter_value</span><span class="p">,</span>
                <span class="n">column_name</span><span class="o">=</span><span class="n">column_name</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="n">substring</span><span class="p">,</span>
                <span class="n">negate</span><span class="o">=</span><span class="n">negated</span><span class="p">,</span>
                <span class="n">keep_nulls</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keep_nulls&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;min_value&quot;</span> <span class="ow">in</span> <span class="n">spec</span> <span class="ow">or</span> <span class="s2">&quot;max_value&quot;</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">:</span>
            <span class="n">min_value</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;min_value&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="n">max_value</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_value&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="n">min_inclusive</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;min_inclusive&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">max_inclusive</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_inclusive&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">negated</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;negate&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

            <span class="n">min_end</span> <span class="o">=</span> <span class="s2">&quot;[&quot;</span> <span class="k">if</span> <span class="n">min_inclusive</span> <span class="k">else</span> <span class="s2">&quot;(&quot;</span>
            <span class="n">max_end</span> <span class="o">=</span> <span class="s2">&quot;]&quot;</span> <span class="k">if</span> <span class="n">max_inclusive</span> <span class="k">else</span> <span class="s2">&quot;)&quot;</span>
            <span class="n">registration_key</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">min_end</span><span class="si">}{</span><span class="n">min_value</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">max_value</span><span class="si">}{</span><span class="n">max_end</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

            <span class="n">slice_function</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
                <span class="n">filter_range</span><span class="p">,</span>
                <span class="n">column_name</span><span class="o">=</span><span class="n">column_name</span><span class="p">,</span>
                <span class="n">min_value</span><span class="o">=</span><span class="n">min_value</span><span class="p">,</span>
                <span class="n">max_value</span><span class="o">=</span><span class="n">max_value</span><span class="p">,</span>
                <span class="n">min_inclusive</span><span class="o">=</span><span class="n">min_inclusive</span><span class="p">,</span>
                <span class="n">max_inclusive</span><span class="o">=</span><span class="n">max_inclusive</span><span class="p">,</span>
                <span class="n">negate</span><span class="o">=</span><span class="n">negated</span><span class="p">,</span>
                <span class="n">keep_nulls</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keep_nulls&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">spec</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="s2">&quot;day&quot;</span><span class="p">,</span> <span class="s2">&quot;hour&quot;</span><span class="p">)):</span>
            <span class="n">year</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>
            <span class="n">month</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;month&quot;</span><span class="p">)</span>
            <span class="n">day</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;day&quot;</span><span class="p">)</span>
            <span class="n">hour</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hour&quot;</span><span class="p">)</span>
            <span class="n">negated</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;negate&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

            <span class="c1"># create registration key with year, month, day, hour if specified</span>
            <span class="n">registration_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s2">:&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                        <span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="s2">&quot;day&quot;</span><span class="p">,</span> <span class="s2">&quot;hour&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hour</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="p">]</span>
            <span class="p">)</span>

            <span class="n">slice_function</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
                <span class="n">filter_datetime</span><span class="p">,</span>
                <span class="n">column_name</span><span class="o">=</span><span class="n">column_name</span><span class="p">,</span>
                <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span>
                <span class="n">month</span><span class="o">=</span><span class="n">month</span><span class="p">,</span>
                <span class="n">day</span><span class="o">=</span><span class="n">day</span><span class="p">,</span>
                <span class="n">hour</span><span class="o">=</span><span class="n">hour</span><span class="p">,</span>
                <span class="n">negate</span><span class="o">=</span><span class="n">negated</span><span class="p">,</span>
                <span class="n">keep_nulls</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keep_nulls&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;contains&quot;</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">:</span>
            <span class="n">substring</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;contains&quot;</span><span class="p">]</span>
            <span class="n">negated</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;negate&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

            <span class="n">registration_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s2">:contains </span><span class="si">{</span><span class="n">substring</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">slice_function</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
                <span class="n">filter_string_contains</span><span class="p">,</span>
                <span class="n">column_name</span><span class="o">=</span><span class="n">column_name</span><span class="p">,</span>
                <span class="n">contains</span><span class="o">=</span><span class="n">substring</span><span class="p">,</span>
                <span class="n">negate</span><span class="o">=</span><span class="n">negated</span><span class="p">,</span>
                <span class="n">keep_nulls</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keep_nulls&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;keep_nulls&quot;</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">:</span>
            <span class="n">keep_nulls</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;keep_nulls&quot;</span><span class="p">]</span>
            <span class="n">negated</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;negate&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

            <span class="c1"># keep_nulls=True and negate=True =&gt; filter_non-null(negate=False)</span>
            <span class="c1"># keep_nulls=False and negate=True =&gt; filter_non-null(negate=True)</span>
            <span class="c1"># keep_nulls=True and negate=False =&gt; filter_non-null(negate=True)</span>
            <span class="c1"># keep_nulls=False and negate=False =&gt; filter_non-null(negate=False)</span>
            <span class="n">negated</span> <span class="o">=</span> <span class="n">keep_nulls</span> <span class="o">^</span> <span class="n">negated</span>  <span class="c1"># XOR</span>

            <span class="n">registration_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s2">:non_null&quot;</span>
            <span class="n">slice_function</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
                <span class="n">filter_non_null</span><span class="p">,</span> <span class="n">column_names</span><span class="o">=</span><span class="n">column_name</span><span class="p">,</span> <span class="n">negate</span><span class="o">=</span><span class="n">negated</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Expected the slice specification to contain `value`, `min_value`, &quot;</span>
                <span class="s2">&quot;`max_value`, `contains`, `year`, `month`, `day`, `hour` or &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;`keep_nulls`. Got </span><span class="si">{</span><span class="n">spec</span><span class="si">}</span><span class="s2"> instead.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">negated</span><span class="p">:</span>
            <span class="n">registration_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;!(</span><span class="si">{</span><span class="n">registration_key</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="k">return</span> <span class="n">registration_key</span><span class="p">,</span> <span class="n">slice_function</span>

    <span class="k">def</span> <span class="nf">_check_column_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_names</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that the given column names are valid.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_column_names</span><span class="p">(</span><span class="n">column_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">validate</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="n">column_names</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_names</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Column name &#39;</span><span class="si">{</span><span class="n">column_names</span><span class="si">}</span><span class="s2">&#39; is not in the dataset. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Valid column names are: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">column_names</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Expected `column_names` to be a string or list of strings.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span><span class="si">}</span><span class="s2"> instead.&quot;</span>
            <span class="p">)</span></div>


<span class="c1"># filter functions</span>
<div class="viewcode-block" id="overall"><a class="viewcode-back" href="../../../reference/api/_autosummary/cyclops.data.slicer.overall.html#cyclops.data.slicer.overall">[docs]</a><span class="k">def</span> <span class="nf">overall</span><span class="p">(</span><span class="n">examples</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True for all examples.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    examples : Dict[str, Any]</span>
<span class="sd">        A dictionary of features and values.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Union[bool, List[bool]]</span>
<span class="sd">        A boolean or a list of booleans containing `True` for all examples.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span>
        <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">examples</span><span class="o">.</span><span class="n">values</span><span class="p">())),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span>
    <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="filter_non_null"><a class="viewcode-back" href="../../../reference/api/_autosummary/cyclops.data.slicer.filter_non_null.html#cyclops.data.slicer.filter_non_null">[docs]</a><span class="k">def</span> <span class="nf">filter_non_null</span><span class="p">(</span>
    <span class="n">examples</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">column_names</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">negate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True for all examples where the feature/column is not null.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    examples : Dict[str, Any]</span>
<span class="sd">        A dictionary of features and values.</span>
<span class="sd">    column_names : Union[str, List[str]]</span>
<span class="sd">        The column name(s) on which to filter.</span>
<span class="sd">    negate : bool, optional, default=False</span>
<span class="sd">        If `True`, negate the filter, i.e. return `True` for all examples where</span>
<span class="sd">        the value is null/nan.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Union[bool, List[bool]]</span>
<span class="sd">        A boolean or a list of booleans containing `True` for all examples where</span>
<span class="sd">        the value is not null/nan.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
        <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="ow">or</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Expected `column_names` to be a string or list of strings. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="n">column_names</span><span class="si">}</span><span class="s2"> of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">column_names</span><span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">examples</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="k">for</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">result</span> <span class="o">&amp;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">examples</span><span class="p">[</span><span class="n">column_name</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">negate</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="o">~</span><span class="n">result</span>

    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1"># type: ignore</span></div>


<div class="viewcode-block" id="filter_value"><a class="viewcode-back" href="../../../reference/api/_autosummary/cyclops.data.slicer.filter_value.html#cyclops.data.slicer.filter_value">[docs]</a><span class="k">def</span> <span class="nf">filter_value</span><span class="p">(</span>
    <span class="n">examples</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
    <span class="n">negate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">keep_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True for all examples where the feature/column has the given value.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    examples : Dict[str, Any]</span>
<span class="sd">        A dictionary of features and values.</span>
<span class="sd">    column_name : str</span>
<span class="sd">        The column name on which to filter.</span>
<span class="sd">    value : Union[Any, List[Any]]</span>
<span class="sd">        The value or values to find. Exact match is performed.</span>
<span class="sd">    negate : bool, optional, default=False</span>
<span class="sd">        If `True`, return `True` for all examples where the column does not have</span>
<span class="sd">        the given value.</span>
<span class="sd">    keep_nulls : bool, optional, default=False</span>
<span class="sd">        If `True`, return `True` for all examples in the column where the value is null.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Union[bool, List[bool]]</span>
<span class="sd">        A boolean or a list of booleans containing `True` for all examples where</span>
<span class="sd">        the feature has the given value or values.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">value_is_datetime</span> <span class="o">=</span> <span class="n">is_datetime</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>  <span class="c1"># only checks timestrings</span>

    <span class="n">value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
        <span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;datetime64[ns]&quot;</span> <span class="k">if</span> <span class="n">value_is_datetime</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="n">example_values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
        <span class="n">examples</span><span class="p">[</span><span class="n">column_name</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;datetime64[ns]&quot;</span> <span class="k">if</span> <span class="n">value_is_datetime</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">example_values</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="n">negate</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">keep_nulls</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">|=</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">example_values</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">&amp;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">example_values</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1"># type: ignore</span></div>


<div class="viewcode-block" id="filter_range"><a class="viewcode-back" href="../../../reference/api/_autosummary/cyclops.data.slicer.filter_range.html#cyclops.data.slicer.filter_range">[docs]</a><span class="k">def</span> <span class="nf">filter_range</span><span class="p">(</span>
    <span class="n">examples</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">min_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
    <span class="n">max_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
    <span class="n">min_inclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">max_inclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">negate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">keep_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True for all examples where the value is in the given range.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    examples : Dict[str, Any]</span>
<span class="sd">        A dictionary of features and values.</span>
<span class="sd">    column_name : str</span>
<span class="sd">        The column name on which to filter.</span>
<span class="sd">    min_value : float, optional, default=-np.inf</span>
<span class="sd">        The minimum value of the range.</span>
<span class="sd">    max_value : float, optional, default=np.inf</span>
<span class="sd">        The maximum value of the range.</span>
<span class="sd">    min_inclusive : bool, optional, default=True</span>
<span class="sd">        If `True`, include the minimum value in the range.</span>
<span class="sd">    max_inclusive : bool, optional, default=True</span>
<span class="sd">        If `True`, include the maximum value in the range.</span>
<span class="sd">    negate : bool, optional, default=False</span>
<span class="sd">        If `True`, return `True` for all examples in the column where the value is</span>
<span class="sd">        not in the given range.</span>
<span class="sd">    keep_nulls : bool, optional, default=False</span>
<span class="sd">        If `True`, return `True` for all examples in the column where the value is null.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Union[bool, List[bool]]</span>
<span class="sd">        A boolean or a list of booleans containing `True` for all examples in the</span>
<span class="sd">        column where the value is in the given range.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If `max_value` is less than `min_value` or if `min_value` and `max_value`</span>
<span class="sd">        are equal and either `min_inclusive` or `max_inclusive` is False.</span>
<span class="sd">    TypeError</span>
<span class="sd">        If the column does not contain numeric or datetime values.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># handle datetime values</span>
    <span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="p">,</span> <span class="n">value_is_datetime</span> <span class="o">=</span> <span class="n">_maybe_convert_to_datetime</span><span class="p">(</span>
        <span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">min_value</span> <span class="o">&gt;</span> <span class="n">max_value</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Expected `min_value` to be less than or equal to `max_value`, but got &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;min_value=</span><span class="si">{</span><span class="n">min_value</span><span class="si">}</span><span class="s2"> and max_value=</span><span class="si">{</span><span class="n">max_value</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">min_value</span> <span class="o">==</span> <span class="n">max_value</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">min_inclusive</span> <span class="ow">and</span> <span class="n">max_inclusive</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;`min_value` and `max_value` are equal and either `min_inclusive` or &quot;</span>
            <span class="s2">&quot;`max_inclusive` is False. This would result in an empty range.&quot;</span>
        <span class="p">)</span>

    <span class="n">example_values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
        <span class="n">examples</span><span class="p">[</span><span class="n">column_name</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;datetime64[ns]&quot;</span> <span class="k">if</span> <span class="n">value_is_datetime</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>  <span class="c1"># column does not contain number or datetime values</span>
        <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">example_values</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
        <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">example_values</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;Expected feature to be numeric or datetime, but got &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">example_values</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">((</span><span class="n">example_values</span> <span class="o">&gt;</span> <span class="n">min_value</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">example_values</span> <span class="o">&lt;</span> <span class="n">max_value</span><span class="p">))</span>
        <span class="o">|</span> <span class="p">((</span><span class="n">example_values</span> <span class="o">==</span> <span class="n">min_value</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">min_inclusive</span><span class="p">)</span>
        <span class="o">|</span> <span class="p">((</span><span class="n">example_values</span> <span class="o">==</span> <span class="n">max_value</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">max_inclusive</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">negate</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="o">~</span><span class="n">result</span>

    <span class="k">if</span> <span class="n">keep_nulls</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">|=</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">example_values</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">&amp;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">example_values</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1"># type: ignore</span></div>


<div class="viewcode-block" id="filter_datetime"><a class="viewcode-back" href="../../../reference/api/_autosummary/cyclops.data.slicer.filter_datetime.html#cyclops.data.slicer.filter_datetime">[docs]</a><span class="k">def</span> <span class="nf">filter_datetime</span><span class="p">(</span>
    <span class="n">examples</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">year</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">month</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">day</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hour</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">negate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">keep_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True for all examples where the datetime value matches the given datetime.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    examples : Dict[str, Any]</span>
<span class="sd">        A dictionary of features and values.</span>
<span class="sd">    column_name : str</span>
<span class="sd">        The column name on which to filter.</span>
<span class="sd">    year : int, str, List[int], List[str], optional, default=None</span>
<span class="sd">        The year to match. If string, it must be a valid year string (e.g. &quot;2020&quot;).</span>
<span class="sd">        If a list is provided, return `True` for all examples where the year matches</span>
<span class="sd">        any of the values in the list.</span>
<span class="sd">    month : int, List[int], optional, default=None</span>
<span class="sd">        The month to match. If a list is provided, return `True` for all examples</span>
<span class="sd">        where the month matches any of the values in the list.</span>
<span class="sd">    day : int, List[int], optional, default=None</span>
<span class="sd">        The day to match. If a list is provided, return `True` for all examples</span>
<span class="sd">        where the day matches any of the values in the list.</span>
<span class="sd">    hour : int, List[int], optional, default=None</span>
<span class="sd">        The hour to match. If a list is provided, return `True` for all examples</span>
<span class="sd">        where the hour matches any of the values in the list.</span>
<span class="sd">    negate : bool, optional, default=False</span>
<span class="sd">        If `True`, return `True` for all examples where the value does not match</span>
<span class="sd">        the given datetime components.</span>
<span class="sd">    keep_nulls : bool, optional, default=False</span>
<span class="sd">        If `True`, return `True` for all examples that have a null/nan/NaT value.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Union[bool, List[bool]]</span>
<span class="sd">        A boolean or a list of booleans containing `True` for all examples where</span>
<span class="sd">        the value of a column matches the given datetime components.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">        If the column does not contain datetime values.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># make sure the column has datetime type</span>
    <span class="n">example_values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">examples</span><span class="p">[</span><span class="n">column_name</span><span class="p">])</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">example_values</span> <span class="o">=</span> <span class="n">example_values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;Expected datetime feature, but got feature of type &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">example_values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>

    <span class="c1"># convert the datetime values to year, month, day, hour</span>
    <span class="n">years</span><span class="p">,</span> <span class="n">months</span><span class="p">,</span> <span class="n">days</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">example_values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;M8[</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="c1"># get all the values that match the given datetime</span>
    <span class="c1"># acknowledgement: https://stackoverflow.com/a/56260054</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">example_values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">year</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">&amp;=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
            <span class="n">element</span><span class="o">=</span><span class="n">years</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1970</span><span class="p">,</span>
            <span class="n">test_elements</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">month</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">&amp;=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
            <span class="n">element</span><span class="o">=</span><span class="p">((</span><span class="n">months</span> <span class="o">-</span> <span class="n">years</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
            <span class="n">test_elements</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">month</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">day</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">&amp;=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
            <span class="n">element</span><span class="o">=</span><span class="p">((</span><span class="n">days</span> <span class="o">-</span> <span class="n">months</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
            <span class="n">test_elements</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">hour</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">&amp;=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
            <span class="n">element</span><span class="o">=</span><span class="p">(</span><span class="n">example_values</span> <span class="o">-</span> <span class="n">days</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;m8[h]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
            <span class="n">test_elements</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">hour</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">negate</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="o">~</span><span class="n">result</span>

    <span class="k">if</span> <span class="n">keep_nulls</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">|=</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">example_values</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">&amp;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">example_values</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1"># type: ignore</span></div>


<div class="viewcode-block" id="filter_string_contains"><a class="viewcode-back" href="../../../reference/api/_autosummary/cyclops.data.slicer.filter_string_contains.html#cyclops.data.slicer.filter_string_contains">[docs]</a><span class="k">def</span> <span class="nf">filter_string_contains</span><span class="p">(</span>
    <span class="n">examples</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">contains</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
    <span class="n">negate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">keep_nulls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True for all examples where the value contains the given substring.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    examples : Dict[str, Any]</span>
<span class="sd">        A dictionary of features and values.</span>
<span class="sd">    column_name : str</span>
<span class="sd">        The column name on which to filter.</span>
<span class="sd">    contains : str, List[str]</span>
<span class="sd">        The substring to match. If a list is provided, return `True` for all</span>
<span class="sd">        examples where the value contains any of the substrings in the list.</span>
<span class="sd">    negate : bool, optional, default=False</span>
<span class="sd">        If `True`, return `True` for all examples where the value does not contain</span>
<span class="sd">        the given substring.</span>
<span class="sd">    keep_nulls : bool, optional, default=False</span>
<span class="sd">        If `True`, return `True` for all examples that have a null value.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Union[bool, List[bool]]</span>
<span class="sd">        A boolean or a list of booleans containing `True` for all examples where</span>
<span class="sd">        the value of a column contains the given substring.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">        If the column does not contain string values or if the values in</span>
<span class="sd">        `contains` are not strings.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># make sure the column has string type</span>
    <span class="n">example_values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">examples</span><span class="p">[</span><span class="n">column_name</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">example_values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;object&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
        <span class="n">example_values</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">StringDtype</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Expected string feature, but got feature of type &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">example_values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">example_values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;object&quot;</span><span class="p">:</span>  <span class="c1"># object type could be string</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">example_values</span><span class="o">.</span><span class="n">str</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Expected string feature, but got feature of type &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">example_values</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>

    <span class="c1"># get all the values that contain the given substring</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">example_values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">contains</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">contains</span> <span class="o">=</span> <span class="p">[</span><span class="n">contains</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">substring</span> <span class="ow">in</span> <span class="n">contains</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">substring</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Expected string value for `contains`, but got value of type &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">substring</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="n">result</span> <span class="o">|=</span> <span class="n">example_values</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">substring</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">negate</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="o">~</span><span class="n">result</span>

    <span class="k">if</span> <span class="n">keep_nulls</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">|=</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">example_values</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">&amp;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">example_values</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1"># type: ignore</span></div>


<div class="viewcode-block" id="compound_filter"><a class="viewcode-back" href="../../../reference/api/_autosummary/cyclops.data.slicer.compound_filter.html#cyclops.data.slicer.compound_filter">[docs]</a><span class="k">def</span> <span class="nf">compound_filter</span><span class="p">(</span>
    <span class="n">examples</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">slice_functions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine the result of multiple slices using bitwise AND.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    examples : Dict[str, Any]</span>
<span class="sd">        A dictionary mapping column names to values.</span>
<span class="sd">    slice_functions : List[Callable]</span>
<span class="sd">        A list of functions to apply to the examples. The signature of each</span>
<span class="sd">        function should be: `slice_function(examples, **kwargs)`.</span>
<span class="sd">        The result of each function should be a boolean or a list of booleans.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Union[bool, List[bool]]</span>
<span class="sd">        A boolean or a list of booleans containing `True` for all examples where</span>
<span class="sd">        each slice function returns `True`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bitwise_and</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span>
        <span class="p">[</span><span class="n">slice_function</span><span class="p">(</span><span class="n">examples</span><span class="p">)</span> <span class="k">for</span> <span class="n">slice_function</span> <span class="ow">in</span> <span class="n">slice_functions</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span></div>


<span class="c1"># utility functions</span>
<div class="viewcode-block" id="is_datetime"><a class="viewcode-back" href="../../../reference/api/_autosummary/cyclops.data.slicer.is_datetime.html#cyclops.data.slicer.is_datetime">[docs]</a><span class="k">def</span> <span class="nf">is_datetime</span><span class="p">(</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="nb">str</span><span class="p">,</span>
        <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
        <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
        <span class="n">Any</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the given value is a datetime.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    value : Union[str, datetime.datetime, np.datetime64, np.ndarray, List]</span>
<span class="sd">        The value(s) to check.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if the value is a datetime, False otherwise.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">parse</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">((</span><span class="n">is_datetime</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">)):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="kc">False</span></div>


<span class="k">def</span> <span class="nf">_maybe_convert_to_datetime</span><span class="p">(</span><span class="n">min_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">max_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert datetime and infinity values to np.datetime64.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    min_value : Any</span>
<span class="sd">        The minimum value.</span>
<span class="sd">    max_value : Any</span>
<span class="sd">        The maximum value.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Tuple[Any, Any, bool]</span>
<span class="sd">        The minimum and maximum values, and a boolean indicating whether the</span>
<span class="sd">        values are datetime values.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">):</span>
        <span class="n">min_value</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">):</span>
        <span class="n">max_value</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">max_value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>

    <span class="c1"># convert datetime and infinity values to np.datetime64</span>
    <span class="n">value_is_datetime</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">is_datetime</span><span class="p">(</span><span class="n">min_value</span><span class="p">):</span>
        <span class="n">min_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">min_value</span><span class="p">)</span>
        <span class="n">value_is_datetime</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">max_value</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
            <span class="n">max_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">to_datetime64</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">is_datetime</span><span class="p">(</span><span class="n">max_value</span><span class="p">):</span>
        <span class="n">max_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">max_value</span><span class="p">)</span>
        <span class="n">value_is_datetime</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">min_value</span> <span class="o">==</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
            <span class="n">min_value</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">to_datetime64</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="p">,</span> <span class="n">value_is_datetime</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  

  <div class="citation">
    CyclOps team <i>et al.,</i>
    <a href="https://www.medrxiv.org/content/10.1101/2022.12.02.22283021v2">CyclOps: Cyclical development towards Operationalizing ML models for health</a>
    <i>, medarxiv</i> (2022)
  </def>


  <p class="avatar">cyclops is built by</p>
  <div class="avatar">
    
    
    <span>
      <a href="https://github.com/amrit110">
        <img src="../../../_static/team/amrit-krishnan.jpg" width="32"/>
        Amrit Krishnan
      </a>
    </span>
    ,
    
    <span>
      <a href="https://github.com/KadenMc">
        <img src="../../../_static/team/kaden-mckeen.jpg" width="32"/>
        Kaden McKeen
      </a>
    </span>
    ,
    
    <span>
      <a href="https://github.com/vsubasri">
        <img src="../../../_static/team/valli-subasri.jpg" width="32"/>
        Valli Subasri
      </a>
    </span>
    ,
    
    <span>
      <a href="https://github.com/a-kore">
        <img src="../../../_static/team/ali-kore.jpg" width="32"/>
        Ali Kore
      </a>
    </span>
    ,
    
    <span>
      <a href="https://github.com/fcogidi">
        <img src="../../../_static/team/franklin-ogidi.jpg" width="32"/>
        Franklin Ogidi
      </a>
    </span>
    ,
    
    <span>
      <a href="https://github.com/mahshidaln">
        <img src="../../../_static/team/mahshid-alinoori.jpg" width="32"/>
        Mahshid Alinoori
      </a>
    </span>
    ,
    
    <span>
      <a href="https://github.com/elhamdolatabadi">
        <img src="../../../_static/team/elham-dolatabadi.jpg" width="32"/>
        Elham Dolatabadi
      </a>
    </span>
    ,
  </div>


  <div class="footer-small-text">
    All <a href="https://github.com/VectorInstitute/cyclops">source code for cyclops</a> is freely available under the terms of an <a href="https://opensource.org/licenses/Apache-2.0">Apache-2.0</a> license.
  </div>

  <div class="footer-small-text">
    This work is made possible due to the data obtained from the
    General Medicine Inpatient Initiative (GEMINI).
  </div>

  <hr/>

  <div class="logo">
    <a class="logo" href="https://vectorinstitute.ai/">
      <span class="logo"></span>
      <img alt="Logo of the Vector Institute" style="width:90px; max-width:90px;" src="../../../_static/logos/vector_logo.png" />
    </a>
    <a class="logo" href="https://www.geminimedicine.ca/">
      <span class="logo"></span>
      <img alt="Logo of GEMINI" style="width:90px; max-width:90px;" src="../../../_static/logos/gemini_logo.png" />
    </a>
  </div>

  <div class="copyright">
    &copy; Copyright 2022, Vector AI Engineering
  </div>

  <div class="copyright">
    </p>
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using customised version of
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">base theme</a> provided by
    <a href="https://readthedocs.org">Read the Docs</a>.
  </div>



</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>